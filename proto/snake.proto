syntax = "proto3";

package snake;

option go_package = "github.com/brensch/snek2/gen/go";

message Point {
  int32 x = 1;
  int32 y = 2;
}

message Snake {
  string id = 1;
  int32 health = 2;
  repeated Point body = 3;
}

message GameState {
  int32 width = 1;
  int32 height = 2;
  repeated Snake snakes = 3;
  repeated Point food = 4;
  string you_id = 5; // ID of the snake to infer for
  int32 turn = 6;
}

message InferenceRequest {
  bytes data = 1;
  repeated int32 shape = 2;
}

// Represents the prediction for a single GameState
message InferenceResponse {
  // Probabilities for Up, Down, Left, Right for each snake (4 * 4 = 16 floats)
  // Order: Snake 1 (U,D,L,R), Snake 2 (U,D,L,R), ...
  repeated float policies = 1;
  // Win probability for each snake (4 floats)
  repeated float values = 2;
}

message BatchInferenceResponse {
  repeated InferenceResponse responses = 1;
}

message TrainingExample {
  bytes state_data = 1;
  // 16 floats (4 snakes * 4 moves)
  repeated float policies = 2;
  // 4 floats (one value per snake)
  repeated float values = 3;
}

message TrainingData {
  repeated TrainingExample examples = 1;
}

service InferenceService {
  rpc Predict(InferenceRequest) returns (BatchInferenceResponse);
}
